<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="estilo.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>Estatísticas do Quiz</title>
</head>

<body>
    <div class="ret_principal">
        <div id="ret_superior_dashboard">
            <span id="titulo_dashboard">Estatísticas do Quiz</span>
            <button onclick="iniciar()" class="but_superior">Voltar ao Início</button>
            <button onclick="anterior()" class="but_superior">Página Anterior</button>


        </div>
        <span class="linha"></span>
        <div id="cards">
            <div class="card"><b>Castlevania: Symphony of the Night</b>Jogo mais Recomendado</div>
            <div class="card"><b>Metroidvania</b>Gênero mais escolhido</div>
            <div class="card"><b>20</b>Número de acessos</div>
            <div class="card"><b>História</b> Maior impacto na escolha</div>
        </div>
        <div id="graficos">
            <span class="grafico"> <canvas id="Barras"></canvas> </span>
            <span class="grafico2"> <canvas id="Pizza"></canvas> </span>
        </div>
    </div>
</body>
<script>
    const js_pizza = document.getElementById('Pizza');



    //Implementar Atualização no futuro
    // let proximaAtualizacao;

    obterDadosGrafico()

    function obterDadosGrafico() {


        /*if (proximaAtualizacao != undefined) {
            clearTimeout(proximaAtualizacao);
        }*/

        fetch(`/dashboard/contar`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);

                    plotarGrafico(resposta);

                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

    function plotarGrafico(resposta) {

        console.log('iniciando plotagem do gráfico...');

        // Criando estrutura para plotar gráfico - dados
        let dados = {
            labels: ['SOTN', 'MMX', 'FFT', 'OFT', 'RE2', 'CT' ],
            datasets: [
                {
                    label: 'Jogos Recomendados',
                    data: [0, 0, 0, 0, 0, 0],
                    backgroundColor: '#5f4e50',
                    borderWidth: 1
                }]
        };

        console.log('----------------------------------------------')
        console.log('Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":')
        console.log(resposta)

        // Inserindo valores recebidos em estrutura para plotar o gráfico
        for (i = 0; i < resposta.length; i++) {
            var registro = resposta[i];
            dados.datasets[0].data[registro.numJogo - 1] = registro.vezesRecomendado;
        }

        console.log('----------------------------------------------')
        console.log('O gráfico será plotado com os respectivos valores:')
        console.log('Labels:')
        console.log(dados.labels)
        console.log('Dados:')
        console.log(dados.datasets)
        console.log('----------------------------------------------')

        // Criando estrutura para plotar gráfico - config
        const config = {
            type: 'bar',
            data: dados,
            options: {
                scales: {
                    x: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Siglas dos Jogos'
                        },
                    },
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Vezes Que Foram Recomendados'
                        },
                    }
                },
                plugins: {
                    title: {
                        display: true,
                        text: 'Jogos Mais Recomendados Pelo Quiz'
                    }
                }
            }
        };

        // Adicionando gráfico criado em div na tela
        let myChart = new Chart(
            document.getElementById('Barras'),
            config
        );

        // setTimeout(() => atualizarGrafico(idAquario, dados, myChart), 2000);
    }


    new Chart(js_pizza, {
        type: 'pie',
        data: {
            datasets: [{
                data: [5, 4, 3, 2, 3, 3]
            }],
            labels: [
                'Metroidvania',
                'Terror',
                'Plataforma',
                'Aventura',
                'RPG',
                'Estrátegia']
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'top',
                },
                title: {
                    display: true,
                    text: 'Gêneros Mais Recomendados'
                }
            }
        }
    });

    function iniciar() {
        window.location.href = "index.html"
    }
    function anterior() {
        window.location.href = "Recomendacao.html"
    }
</script>

</html>