<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="estilo.css">
    <title>Jogos Retrô</title>
</head>

<body>
    <div class="ret_principal">
        <div class="ret_secundario">
            <p id="titulo_inicio">JOGOS RETRÔ</p> <br> <br>
            <p id="subtitulo">O Frescor do Passado</p><br>
            <p id="texto">Os gamers procuram constantemente novos lançamentos com as mais novas tecnologias e inovações
                do mercado, em sua visão, os novos games devem ser maiores em todos os quesitos, porém, o que muitos
                ignoram é que, nem sempre, ser maior significa ser melhor e, as vezes, olhar para o passado é o melhor
                caminho para construir um bom futuro. Por esse motivo, elaborei um quiz para, de acordo com seu perfil,
                recomendar-lhe um bom game retrô.</p> <br>
            <input type="text" id="ipt_nome" placeholder="Seu Nome"> <br>
            <button onclick="quiz()" id="but_iniciar">Iniciar Quiz</button>
        </div>
        <div class="ret_secundario">
            <img id="img_jogo" src="Capas/SOFTN.jpg" alt="jogo"></img>
            <b id="legenda_jogo">Castlevania: Symphony of the Night - 1997</b>
        </div>
    </div>
</body>
<script>
    var caso = Number((Math.random() * 5).toFixed(0));
    switch (caso) {
        case 0:
            img_jogo.src = "Capas/CT.jpg"
            legenda_jogo.innerHTML = 'Chrono Trigger - 1995';
            break;
        case 1:
            img_jogo.src = "Capas/RE2.png"
            legenda_jogo.innerHTML = 'Resident Evil 2 - 1998';
            break;
        case 2:
            img_jogo.src = "Capas/OFT.jpg"
            legenda_jogo.innerHTML = 'The Legend of Zelda Ocarina Of Time - 1998';
            break;
        case 3:
            img_jogo.src = "Capas/FFT.jpg"
            legenda_jogo.innerHTML = 'Final Fantasy Tactics - 1997';
            break;
        case 4:
            img_jogo.src = "Capas/MMX.jpg"
            legenda_jogo.innerHTML = 'Mega Man X - 1993';
            break;
        case 5:
            img_jogo.src = "Capas/SOTN.jpg"
            legenda_jogo.innerHTML = 'Castlevania: Symphony of the Night - 1997';
            break;
    }
    var qtdAcessos = [];
    var nomeVar = ipt_nome.value
    var qtdAcessos = [];
    sessionStorage.setItem('nome', nomeVar);

    function captarAcessos() {
        fetch(`/usuarios2/listar`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    qtdAcessos = resposta;
                    return true

                });
            } else {
                alert('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

    function quiz() {
        var nomeVar = ipt_nome.value
        sessionStorage.setItem('nome', nomeVar);

        fetch("/usuarios2/cadastrar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                nomeServer: nomeVar
            }),
        })
            .then(function (resposta) {
                console.log("resposta: ", resposta);

                if (resposta.ok) {
                    captarAcessos();

                    setTimeout(() => {
                        sessionStorage.setItem('acessos', qtdAcessos[0].acessos);
                    }, "400");

                    setTimeout(() => {
                        window.location = "Quiz.html";
                    }, "500");
                } else {
                    throw "Houve um erro ao tentar realizar o cadastro!";
                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });
    }   
</script>

</html>
<!--        var nomeVar = ipt_nome.value
        var qtdAcessos = [];
        sessionStorage.setItem('nome', nomeVar);

        fetch(`/usuarios2/listar`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    alert(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    qtdAcessos = JSON.stringify(resposta);

                });
            } else {
                alert('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });

        setTimeout(() => {
            alert("Miauuuuuuuuuu " + qtdAcessos);
        }, "10000");-->